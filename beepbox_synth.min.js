var beepbox;!function(t){var i=function(){function t(t,i,s,h){this.t=[],this.i=0;for(var r=s;r<h;r++){var e=t[i.charCodeAt(r)];this.t.push(e>>5&1),this.t.push(e>>4&1),this.t.push(e>>3&1),this.t.push(e>>2&1),this.t.push(e>>1&1),this.t.push(1&e)}}return t.prototype.read=function(t){for(var i=0;t>0;)i<<=1,i+=this.t[this.i++],t--;return i},t.prototype.readLongTail=function(t,i){for(var s=t,h=i;this.t[this.i++];)s+=1<<h,h++;for(;h>0;)h--,this.t[this.i++]&&(s+=1<<h);return s},t.prototype.readPartDuration=function(){return this.readLongTail(1,2)},t.prototype.readPinCount=function(){return this.readLongTail(1,0)},t.prototype.readPitchInterval=function(){return this.read(1)?-this.readLongTail(1,3):this.readLongTail(1,3)},t}(),s=function(){function t(){this.t=[]}return t.prototype.write=function(t,i){for(t--;t>=0;)this.t.push(i>>>t&1),t--},t.prototype.writeLongTail=function(t,i,s){if(s<t)throw new Error("value out of bounds");s-=t;for(var h=i;s>=1<<h;)this.t.push(1),s-=1<<h,h++;for(this.t.push(0);h>0;)h--,this.t.push(s>>>h&1)},t.prototype.writePartDuration=function(t){this.writeLongTail(1,2,t)},t.prototype.writePinCount=function(t){this.writeLongTail(1,0,t)},t.prototype.writePitchInterval=function(t){t<0?(this.write(1,1),this.writeLongTail(1,3,-t)):(this.write(1,0),this.writeLongTail(1,3,t))},t.prototype.concat=function(t){this.t=this.t.concat(t.t)},t.prototype.encodeBase64=function(t,i){for(var s=0;s<this.t.length;s+=6){var h=this.t[s]<<5|this.t[s+1]<<4|this.t[s+2]<<3|this.t[s+3]<<2|this.t[s+4]<<1|this.t[s+5];i.push(t[h])}return i},t.prototype.lengthBase64=function(){return Math.ceil(this.t.length/6)},t}(),h=function(){function t(){}return t.scaleNames=["easy :)","easy :(","island :)","island :(","blues :)","blues :(","normal :)","normal :(","dbl harmonic :)","dbl harmonic :(","enigma","expert"],t.scaleFlags=[[!0,!1,!0,!1,!0,!1,!1,!0,!1,!0,!1,!1],[!0,!1,!1,!0,!1,!0,!1,!0,!1,!1,!0,!1],[!0,!1,!1,!1,!0,!0,!1,!0,!1,!1,!1,!0],[!0,!0,!1,!0,!1,!1,!1,!0,!0,!1,!1,!1],[!0,!1,!0,!0,!0,!1,!1,!0,!1,!0,!1,!1],[!0,!1,!1,!0,!1,!0,!0,!0,!1,!1,!0,!1],[!0,!1,!0,!1,!0,!0,!1,!0,!1,!0,!1,!0],[!0,!1,!0,!0,!1,!0,!1,!0,!0,!1,!0,!1],[!0,!0,!1,!1,!0,!0,!1,!0,!0,!1,!1,!0],[!0,!1,!0,!0,!1,!1,!0,!0,!0,!1,!1,!0],[!0,!1,!0,!1,!0,!1,!0,!1,!0,!1,!0,!1],[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0]],t.pianoScaleFlags=[!0,!1,!0,!1,!0,!0,!1,!0,!1,!0,!1,!0],t.blackKeyNameParents=[-1,1,-1,1,-1,1,-1,-1,1,-1,1,-1],t.pitchNames=["C",null,"D",null,"E","F",null,"G",null,"A",null,"B"],t.keyNames=["B","A♯","A","G♯","G","F♯","F","E","D♯","D","C♯","C"],t.keyTransposes=[23,22,21,20,19,18,17,16,15,14,13,12],t.tempoNames=["molasses","slow","leisurely","moderate","steady","brisk","hasty","fast","strenuous","grueling","hyper","ludicrous"],t.reverbRange=4,t.beatsMin=3,t.beatsMax=15,t.barsMin=1,t.barsMax=128,t.patternsMin=1,t.patternsMax=64,t.instrumentsMin=1,t.instrumentsMax=10,t.partNames=["triples","standard"],t.partCounts=[3,4],t.waveNames=["triangle","square","pulse wide","pulse narrow","sawtooth","double saw","double pulse","spiky","plateau"],t.waveVolumes=[1,.5,.5,.5,.65,.5,.4,.4,.94],t.drumNames=["retro","white"],t.drumVolumes=[.25,1],t.filterNames=["sustain sharp","sustain medium","sustain soft","decay sharp","decay medium","decay soft"],t.filterBases=[2,3.5,5,1,2.5,4],t.filterDecays=[0,0,0,10,7,4],t.filterVolumes=[.4,.7,1,.5,.75,1],t.envelopeNames=["seamless","sudden","smooth","slide"],t.effectNames=["none","vibrato light","vibrato delayed","vibrato heavy","tremelo light","tremelo heavy"],t.effectVibratos=[0,.15,.3,.45,0,0],t.effectTremelos=[0,0,0,0,.25,.5],t.chorusNames=["union","shimmer","hum","honky tonk","dissonant","fifths","octaves","bowed"],t.chorusValues=[0,.02,.05,.1,.25,3.5,6,.02],t.chorusOffsets=[0,0,0,0,0,3.5,6,0],t.chorusVolumes=[.7,.8,1,1,.9,.9,.8,1],t.volumeNames=["loudest","loud","medium","quiet","quietest","mute"],t.volumeValues=[0,.5,1,1.5,2,-1],t.channelVolumes=[.27,.27,.27,.19],t.drumInterval=6,t.numChannels=4,t.drumCount=12,t.pitchCount=37,t.maxPitch=84,t}();function r(t,i,s){return{interval:t,time:i,volume:s}}function e(t,i,s,h,e){return void 0===e&&(e=!1),{pitches:[t],pins:[r(0,0,h),r(0,s-i,e?0:h)],start:i,end:s}}t.Music=h,t.makeNotePin=r,t.makeNote=e;var a=function(){function t(){this.notes=[],this.instrument=0}return t.prototype.cloneNotes=function(){for(var t=[],i=0,s=this.notes;i<s.length;i++){var h=s[i],a=e(-1,h.start,h.end,3);a.pitches=h.pitches.concat(),a.pins=[];for(var n=0,o=h.pins;n<o.length;n++){var f=o[n];a.pins.push(r(f.interval,f.time,f.volume))}t.push(a)}return t},t}();t.BarPattern=a;var n=function(){function t(t){void 0!=t?this.fromBase64String(t):this.initToDefault()}return t.prototype.initToDefault=function(){this.channelPatterns=[[new a,new a,new a,new a,new a,new a,new a,new a],[new a,new a,new a,new a,new a,new a,new a,new a],[new a,new a,new a,new a,new a,new a,new a,new a],[new a,new a,new a,new a,new a,new a,new a,new a]],this.channelBars=[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],this.channelOctaves=[3,2,1,0],this.instrumentVolumes=[[0],[0],[0],[0]],this.instrumentWaves=[[1],[1],[1],[1]],this.instrumentFilters=[[0],[0],[0],[0]],this.instrumentEnvelopes=[[1],[1],[1],[1]],this.instrumentEffects=[[0],[0],[0],[0]],this.instrumentChorus=[[0],[0],[0],[0]],this.scale=0,this.key=h.keyNames.length-1,this.loopStart=0,this.loopLength=4,this.tempo=7,this.reverb=0,this.beats=8,this.bars=16,this.patterns=8,this.parts=4,this.instruments=1},t.prototype.toBase64String=function(){var i,r=[],e=t.s;r.push(e[t.h]),r.push(115,e[this.scale]),r.push(107,e[this.key]),r.push(108,e[this.loopStart>>6],e[63&this.loopStart]),r.push(101,e[this.loopLength-1>>6],e[this.loopLength-1&63]),r.push(116,e[this.tempo]),r.push(109,e[this.reverb]),r.push(97,e[this.beats-1]),r.push(103,e[this.bars-1>>6],e[this.bars-1&63]),r.push(106,e[this.patterns-1]),r.push(105,e[this.instruments-1]),r.push(114,e[h.partCounts.indexOf(this.parts)]),r.push(119);for(var a=0;a<h.numChannels;a++)for(var n=0;n<this.instruments;n++)r.push(e[this.instrumentWaves[a][n]]);r.push(102);for(a=0;a<h.numChannels;a++)for(n=0;n<this.instruments;n++)r.push(e[this.instrumentFilters[a][n]]);r.push(100);for(a=0;a<h.numChannels;a++)for(n=0;n<this.instruments;n++)r.push(e[this.instrumentEnvelopes[a][n]]);r.push(99);for(a=0;a<h.numChannels;a++)for(n=0;n<this.instruments;n++)r.push(e[this.instrumentEffects[a][n]]);r.push(104);for(a=0;a<h.numChannels;a++)for(n=0;n<this.instruments;n++)r.push(e[this.instrumentChorus[a][n]]);r.push(118);for(a=0;a<h.numChannels;a++)for(n=0;n<this.instruments;n++)r.push(e[this.instrumentVolumes[a][n]]);r.push(111);for(a=0;a<h.numChannels;a++)r.push(e[this.channelOctaves[a]]);r.push(98),i=new s;for(var o=0;1<<o<this.patterns+1;)o++;for(a=0;a<h.numChannels;a++)for(n=0;n<this.bars;n++)i.write(o,this.channelBars[a][n]);i.encodeBase64(e,r),r.push(112),i=new s;for(var f=0;1<<f<this.instruments;)f++;for(a=0;a<h.numChannels;a++){var l=3==a?0:12*this.channelOctaves[a],v=(3==a?4:12)+l,u=3==a?[4,6,7,2,3,8,0,10]:[12,19,24,31,36,7,0],c=[];for(n=0;n<u.length;n++)u[n]+=l;for(var d=0,M=this.channelPatterns[a];d<M.length;d++){var w=M[d];if(i.write(f,w.instrument),w.notes.length>0){i.write(1,1);for(var b=0,m=0,y=w.notes;m<y.length;m++){var p=y[m];p.start>b&&(i.write(2,0),i.writePartDuration(p.start-b));var g=new s;for(n=1;n<p.pitches.length;n++)g.write(1,1);p.pitches.length<4&&g.write(1,0),g.writePinCount(p.pins.length-1),g.write(2,p.pins[0].volume);var A=0,F=p.pitches[0],k=F,B=[];for(n=1;n<p.pins.length;n++){var O=p.pins[n],S=F+O.interval;k!=S?(g.write(1,1),B.push(S),k=S):g.write(1,0),g.writePartDuration(O.time-A),A=O.time,g.write(2,O.volume)}var j=String.fromCharCode.apply(null,g.encodeBase64(e,[])),x=c.indexOf(j);-1==x?(i.write(2,1),i.concat(g)):(i.write(1,1),i.writeLongTail(0,0,x),c.splice(x,1)),c.unshift(j),c.length>10&&c.pop();var q=p.pitches.concat(B);for(n=0;n<q.length;n++){var C=q[n],D=u.indexOf(C);if(-1==D){var E=0,G=v;if(G<C)for(;G!=C;)G++,-1==u.indexOf(G)&&E++;else for(;G!=C;)G--,-1==u.indexOf(G)&&E--;i.write(1,0),i.writePitchInterval(E)}else i.write(1,1),i.write(3,D),u.splice(D,1);u.unshift(C),u.length>8&&u.pop(),v=n==p.pitches.length-1?p.pitches[0]:C}b=p.end}b<this.beats*this.parts&&(i.write(2,0),i.writePartDuration(this.beats*this.parts-b))}else i.write(1,0)}}for(var P=i.lengthBase64(),J=[];P>0;)J.unshift(e[63&P]),P>>=6;return r.push(e[J.length]),Array.prototype.push.apply(r,J),i.encodeBase64(e,r),String.fromCharCode.apply(null,r)},t.prototype.fromBase64String=function(s){if(null!=s){for(var n=0;s.charCodeAt(n)<=32;)n++;if(35==s.charCodeAt(n)&&n++,123!=s.charCodeAt(n)){this.initToDefault();var o=t.o[s.charCodeAt(n++)];if(!(-1==o||o>t.h||o<t.l)){var f=o<3,l=o<4,v=o<5,u=t.o;for(f&&(this.instrumentEnvelopes=[[0],[0],[0],[0]]),f&&(this.instrumentWaves=[[1],[1],[1],[0]]);n<s.length;){var c=s.charCodeAt(n++),d=void 0;if(115==c)this.scale=u[s.charCodeAt(n++)],f&&10==this.scale&&(this.scale=11);else if(107==c)this.key=u[s.charCodeAt(n++)];else if(108==c)this.loopStart=v?u[s.charCodeAt(n++)]:(u[s.charCodeAt(n++)]<<6)+u[s.charCodeAt(n++)];else if(101==c)this.loopLength=v?u[s.charCodeAt(n++)]:(u[s.charCodeAt(n++)]<<6)+u[s.charCodeAt(n++)]+1;else if(116==c)this.tempo=l?[1,4,7,10][u[s.charCodeAt(n++)]]:u[s.charCodeAt(n++)],this.tempo=this.v(0,h.tempoNames.length,this.tempo);else if(109==c)this.reverb=u[s.charCodeAt(n++)],this.reverb=this.v(0,h.reverbRange,this.reverb);else if(97==c)this.beats=f?[6,7,8,9,10][u[s.charCodeAt(n++)]]:u[s.charCodeAt(n++)]+1,this.beats=Math.max(h.beatsMin,Math.min(h.beatsMax,this.beats));else if(103==c)this.bars=(u[s.charCodeAt(n++)]<<6)+u[s.charCodeAt(n++)]+1,this.bars=Math.max(h.barsMin,Math.min(h.barsMax,this.bars));else if(106==c)this.patterns=u[s.charCodeAt(n++)]+1,this.patterns=Math.max(h.patternsMin,Math.min(h.patternsMax,this.patterns));else if(105==c)this.instruments=u[s.charCodeAt(n++)]+1,this.instruments=Math.max(h.instrumentsMin,Math.min(h.instrumentsMax,this.instruments));else if(114==c)this.parts=h.partCounts[u[s.charCodeAt(n++)]];else if(119==c)if(f)d=u[s.charCodeAt(n++)],this.instrumentWaves[d][0]=this.v(0,h.waveNames.length,u[s.charCodeAt(n++)]);else for(d=0;d<h.numChannels;d++)for(var M=0;M<this.instruments;M++)this.instrumentWaves[d][M]=this.v(0,h.waveNames.length,u[s.charCodeAt(n++)]);else if(102==c)if(f)d=u[s.charCodeAt(n++)],this.instrumentFilters[d][0]=[0,2,3,5][this.v(0,h.filterNames.length,u[s.charCodeAt(n++)])];else for(d=0;d<h.numChannels;d++)for(M=0;M<this.instruments;M++)this.instrumentFilters[d][M]=this.v(0,h.filterNames.length,u[s.charCodeAt(n++)]);else if(100==c)if(f)d=u[s.charCodeAt(n++)],this.instrumentEnvelopes[d][0]=this.v(0,h.envelopeNames.length,u[s.charCodeAt(n++)]);else for(d=0;d<h.numChannels;d++)for(M=0;M<this.instruments;M++)this.instrumentEnvelopes[d][M]=this.v(0,h.envelopeNames.length,u[s.charCodeAt(n++)]);else if(99==c)if(f)d=u[s.charCodeAt(n++)],this.instrumentEffects[d][0]=this.v(0,h.effectNames.length,u[s.charCodeAt(n++)]),1==this.instrumentEffects[d][0]?this.instrumentEffects[d][0]=3:3==this.instrumentEffects[d][0]&&(this.instrumentEffects[d][0]=5);else for(d=0;d<h.numChannels;d++)for(M=0;M<this.instruments;M++)this.instrumentEffects[d][M]=this.v(0,h.effectNames.length,u[s.charCodeAt(n++)]);else if(104==c)if(f)d=u[s.charCodeAt(n++)],this.instrumentChorus[d][0]=this.v(0,h.chorusNames.length,u[s.charCodeAt(n++)]);else for(d=0;d<h.numChannels;d++)for(M=0;M<this.instruments;M++)this.instrumentChorus[d][M]=this.v(0,h.chorusNames.length,u[s.charCodeAt(n++)]);else if(118==c)if(f)d=u[s.charCodeAt(n++)],this.instrumentVolumes[d][0]=this.v(0,h.volumeNames.length,u[s.charCodeAt(n++)]);else for(d=0;d<h.numChannels;d++)for(M=0;M<this.instruments;M++)this.instrumentVolumes[d][M]=this.v(0,h.volumeNames.length,u[s.charCodeAt(n++)]);else if(111==c)if(f)d=u[s.charCodeAt(n++)],this.channelOctaves[d]=this.v(0,5,u[s.charCodeAt(n++)]);else for(d=0;d<h.numChannels;d++)this.channelOctaves[d]=this.v(0,5,u[s.charCodeAt(n++)]);else if(98==c){var w=void 0;if(f){d=u[s.charCodeAt(n++)];var b=u[s.charCodeAt(n++)];w=Math.ceil(.5*b);var m=new i(u,s,n,n+w);for(M=0;M<b;M++)this.channelBars[d][M]=m.read(3)+1}else if(v){for(var y=0;1<<y<this.patterns;)y++;w=Math.ceil(h.numChannels*this.bars*y/6);m=new i(u,s,n,n+w);for(d=0;d<h.numChannels;d++){this.channelBars[d].length=this.bars;for(M=0;M<this.bars;M++)this.channelBars[d][M]=m.read(y)+1}}else{for(var p=0;1<<p<this.patterns+1;)p++;w=Math.ceil(h.numChannels*this.bars*p/6);m=new i(u,s,n,n+w);for(d=0;d<h.numChannels;d++){this.channelBars[d].length=this.bars;for(M=0;M<this.bars;M++)this.channelBars[d][M]=m.read(p)}}n+=w}else if(112==c){var g=0;if(f)d=u[s.charCodeAt(n++)],n++,g=u[s.charCodeAt(n++)],g<<=6,g+=u[s.charCodeAt(n++)];else{d=0;for(var A=u[s.charCodeAt(n++)];A>0;)g<<=6,g+=u[s.charCodeAt(n++)],A--}m=new i(u,s,n,n+g);n+=g;for(var F=0;1<<F<this.instruments;)F++;for(;;){this.channelPatterns[d]=[];var k=3==d?0:12*this.channelOctaves[d],B=null,O=null,S=(3==d?4:12)+k,j=3==d?[4,6,7,2,3,8,0,10]:[12,19,24,31,36,7,0],x=[];for(M=0;M<j.length;M++)j[M]+=k;for(M=0;M<this.patterns;M++){var q=new a;if(q.instrument=m.read(F),this.channelPatterns[d][M]=q,f||0!=m.read(1)){for(var C=0,D=[];C<this.beats*this.parts;){var E=1==m.read(1),G=!1,P=0;if(E?P=m.readLongTail(0,0):G=1==m.read(1),E||G){var J=void 0,N=void 0,z=void 0;if(E)J=x[P],x.splice(P,1);else{for((J={}).pitchCount=1;J.pitchCount<4&&1==m.read(1);)J.pitchCount++;J.pinCount=m.readPinCount(),J.initialVolume=m.read(2),J.pins=[],J.length=0,J.bendCount=0;for(var H=0;H<J.pinCount;H++)(N={}).pitchBend=1==m.read(1),N.pitchBend&&J.bendCount++,J.length+=m.readPartDuration(),N.time=J.length,N.volume=m.read(2),J.pins.push(N)}x.unshift(J),x.length>10&&x.pop(),(B=e(0,C,C+J.length,J.initialVolume)).pitches=[],B.pins.length=1;var I=[];for(H=0;H<J.pitchCount+J.bendCount;H++){if(1==m.read(1)){var K=m.read(3);z=j[K],j.splice(K,1)}else{var L=m.readPitchInterval();z=S;for(var Q=L;Q>0;){for(z++;-1!=j.indexOf(z);)z++;Q--}for(;Q<0;){for(z--;-1!=j.indexOf(z);)z--;Q++}}j.unshift(z),j.length>8&&j.pop(),H<J.pitchCount?B.pitches.push(z):I.push(z),S=H==J.pitchCount-1?B.pitches[0]:z}I.unshift(B.pitches[0]);for(var R=0,T=J.pins;R<T.length;R++){var U=T[R];U.pitchBend&&I.shift(),O=r(I[0]-B.pitches[0],U.time,U.volume),B.pins.push(O)}C=B.end,D.push(B)}else{C+=m.readPartDuration()}}q.notes=D}}if(f)break;if(++d>=h.numChannels)break}}}}}else this.fromJsonObject(JSON.parse(0==n?s:s.substring(n)))}else this.initToDefault()},t.prototype.toJsonObject=function(i,s,r){void 0===i&&(i=!0),void 0===s&&(s=1),void 0===r&&(r=!0);for(var e=[],a=0;a<h.numChannels;a++){for(var n=[],o=0;o<this.instruments;o++)3==a?n.push({volume:20*(5-this.instrumentVolumes[a][o]),wave:h.drumNames[this.instrumentWaves[a][o]],envelope:h.envelopeNames[this.instrumentEnvelopes[a][o]]}):n.push({volume:20*(5-this.instrumentVolumes[a][o]),wave:h.waveNames[this.instrumentWaves[a][o]],envelope:h.envelopeNames[this.instrumentEnvelopes[a][o]],filter:h.filterNames[this.instrumentFilters[a][o]],chorus:h.chorusNames[this.instrumentChorus[a][o]],effect:h.effectNames[this.instrumentEffects[a][o]]});for(var f=[],l=0,v=this.channelPatterns[a];l<v.length;l++){for(var u=v[l],c=[],d=0,M=u.notes;d<M.length;d++){for(var w=M[d],b=[],m=0,y=w.pins;m<y.length;m++){var p=y[m];b.push({tick:p.time+w.start,pitchBend:p.interval,volume:Math.round(100*p.volume/3)})}c.push({pitches:w.pitches,points:b})}f.push({instrument:u.instrument+1,pitches:c})}var g=[];if(i)for(o=0;o<this.loopStart;o++)g.push(this.channelBars[a][o]);for(var A=0;A<s;A++)for(o=this.loopStart;o<this.loopStart+this.loopLength;o++)g.push(this.channelBars[a][o]);if(r)for(o=this.loopStart+this.loopLength;o<this.bars;o++)g.push(this.channelBars[a][o]);e.push({octaveScrollBar:this.channelOctaves[a],instruments:n,patterns:f,sequence:g})}return{version:t.h,scale:h.scaleNames[this.scale],key:h.keyNames[this.key],introBars:this.loopStart,loopBars:this.loopLength,beatsPerBar:this.beats,ticksPerBeat:this.parts,beatsPerMinute:this.getBeatsPerMinute(),reverb:this.reverb,channels:e}},t.prototype.fromJsonObject=function(t){if((this.initToDefault(),t)&&5===t.version){if(this.scale=11,void 0!=t.scale){var i=h.scaleNames.indexOf(t.scale);-1!=i&&(this.scale=i)}if(void 0!=t.key)if("number"==typeof t.key)this.key=h.keyNames.length-1-(t.key+1200>>>0)%h.keyNames.length;else if("string"==typeof t.key){var s=t.key,n=s.charAt(0).toUpperCase(),o=s.charAt(1).toLowerCase(),f={C:11,D:9,E:7,F:6,G:4,A:2,B:0}[n],l={"#":-1,"♯":-1,b:1,"♭":1}[o];void 0!=f&&(void 0!=l&&(f+=l),f<0&&(f+=12),f%=12,this.key=f)}if(void 0!=t.beatsPerMinute){var v=0|t.beatsPerMinute;this.tempo=Math.round(4+9*Math.log(v/120)/Math.LN2),this.tempo=this.v(0,h.tempoNames.length,this.tempo)}void 0!=t.reverb&&(this.reverb=this.v(0,h.reverbRange,0|t.reverb)),void 0!=t.beatsPerBar&&(this.beats=Math.max(h.beatsMin,Math.min(h.beatsMax,0|t.beatsPerBar))),void 0!=t.ticksPerBeat&&(this.parts=Math.max(3,Math.min(4,0|t.ticksPerBeat)));for(var u=1,c=1,d=1,M=0;M<h.numChannels;M++){if(t.channels&&t.channels[M])(w=t.channels[M]).instruments&&(u=Math.max(u,0|w.instruments.length)),w.patterns&&(c=Math.max(c,0|w.patterns.length)),w.sequence&&(d=Math.max(d,0|w.sequence.length))}this.instruments=u,this.patterns=c,this.bars=d,void 0!=t.introBars&&(this.loopStart=this.v(0,this.bars,0|t.introBars)),void 0!=t.loopBars&&(this.loopLength=this.v(1,this.bars-this.loopStart+1,0|t.loopBars));for(M=0;M<h.numChannels;M++){var w=void 0;t.channels&&(w=t.channels[M]),void 0==w&&(w={}),void 0!=w.octaveScrollBar&&(this.channelOctaves[M]=this.v(0,5,0|w.octaveScrollBar)),this.instrumentVolumes[M].length=this.instruments,this.instrumentWaves[M].length=this.instruments,this.instrumentEnvelopes[M].length=this.instruments,this.instrumentFilters[M].length=this.instruments,this.instrumentChorus[M].length=this.instruments,this.instrumentEffects[M].length=this.instruments,this.channelPatterns[M].length=this.patterns,this.channelBars[M].length=this.bars;for(var b=0;b<this.instruments;b++){var m=void 0;w.instruments&&(m=w.instruments[b]),void 0==m&&(m={}),void 0!=m.volume?this.instrumentVolumes[M][b]=this.v(0,h.volumeNames.length,Math.round(5-(0|m.volume)/20)):this.instrumentVolumes[M][b]=0,this.instrumentEnvelopes[M][b]=h.envelopeNames.indexOf(m.envelope),-1==this.instrumentEnvelopes[M][b]&&(this.instrumentEnvelopes[M][b]=1),3==M?(this.instrumentWaves[M][b]=h.drumNames.indexOf(m.wave),-1==this.instrumentWaves[M][b]&&(this.instrumentWaves[M][b]=0),this.instrumentFilters[M][b]=0,this.instrumentChorus[M][b]=0,this.instrumentEffects[M][b]=0):(this.instrumentWaves[M][b]=h.waveNames.indexOf(m.wave),-1==this.instrumentWaves[M][b]&&(this.instrumentWaves[M][b]=1),this.instrumentFilters[M][b]=h.filterNames.indexOf(m.filter),-1==this.instrumentFilters[M][b]&&(this.instrumentFilters[M][b]=0),this.instrumentChorus[M][b]=h.chorusNames.indexOf(m.chorus),-1==this.instrumentChorus[M][b]&&(this.instrumentChorus[M][b]=0),this.instrumentEffects[M][b]=h.effectNames.indexOf(m.effect),-1==this.instrumentEffects[M][b]&&(this.instrumentEffects[M][b]=0))}for(b=0;b<this.patterns;b++){var y=new a;this.channelPatterns[M][b]=y;var p=void 0;if(w.patterns&&(p=w.patterns[b]),void 0!=p&&(y.instrument=this.v(0,this.instruments,(0|p.instrument)-1),p.pitches&&p.pitches.length>0))for(var g=Math.min(this.beats*this.parts,p.pitches.length>>>0),A=0,F=0;F<p.pitches.length&&!(F>=g);F++){var k=p.pitches[F];if(k&&k.pitches&&k.pitches.length>=1&&k.points&&k.points.length>=2){var B=e(0,0,0,0);B.pitches=[],B.pins=[];for(var O=0;O<k.pitches.length;O++){var S=0|k.pitches[O];if(-1==B.pitches.indexOf(S)&&(B.pitches.push(S),B.pitches.length>=4))break}if(!(B.pitches.length<1)){var j=A,x=0;for(O=0;O<k.points.length;O++){var q=k.points[O];if(void 0!=q&&void 0!=q.tick){var C=void 0==q.pitchBend?0:0|q.pitchBend,D=0|q.tick,E=void 0==q.volume?3:Math.max(0,Math.min(3,Math.round(3*(0|q.volume)/100)));if(!(D>this.beats*this.parts)){if(0==B.pins.length){if(D<j)continue;B.start=D,x=C}else if(D<=j)continue;j=D,B.pins.push(r(C-x,D-B.start,E))}}}if(!(B.pins.length<2)){B.end=B.pins[B.pins.length-1].time+B.start;var G=3==M?h.drumCount-1:h.maxPitch,P=G,J=0;for(O=0;O<B.pitches.length;O++)B.pitches[O]+=x,(B.pitches[O]<0||B.pitches[O]>G)&&(B.pitches.splice(O,1),O--),B.pitches[O]<P&&(P=B.pitches[O]),B.pitches[O]>J&&(J=B.pitches[O]);if(!(B.pitches.length<1)){for(O=0;O<B.pins.length;O++){var N=B.pins[O];N.interval+P<0&&(N.interval=-P),N.interval+J>G&&(N.interval=G-J),O>=2&&N.interval==B.pins[O-1].interval&&N.interval==B.pins[O-2].interval&&N.volume==B.pins[O-1].volume&&N.volume==B.pins[O-2].volume&&(B.pins.splice(O-1,1),O--)}y.notes.push(B),A=B.end}}}}}}for(b=0;b<this.bars;b++)this.channelBars[M][b]=w.sequence?Math.min(this.patterns,w.sequence[b]>>>0):0}}},t.prototype.v=function(t,i,s){return s<=(i-=1)?s>=t?s:t:i},t.prototype.getPattern=function(t,i){var s=this.channelBars[t][i];return 0==s?null:this.channelPatterns[t][s-1]},t.prototype.getPatternInstrument=function(t,i){var s=this.getPattern(t,i);return null==s?0:s.instrument},t.prototype.getBeatsPerMinute=function(){return Math.round(120*Math.pow(2,(-4+this.tempo)/9))},t.l=2,t.h=5,t.o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,62,62,0,0,1,2,3,4,5,6,7,8,9,0,0,0,0,0,0,0,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,0,0,0,0,63,0,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,0,0,0,0,0],t.s=[48,49,50,51,52,53,54,55,56,57,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,45,95],t}();t.Song=n;var o=function(){function t(t){var i=this;void 0===t&&(t=null),this.samplesPerSecond=44100,this.u=.14,this.M=2*Math.PI/(this.u*this.samplesPerSecond),this.m=2*Math.cos(this.M),this.p=1/(2*this.samplesPerSecond),this.g=[new Float64Array([1/15,.2,5/15,7/15,.6,11/15,13/15,1,1,13/15,11/15,.6,7/15,5/15,.2,1/15,-1/15,-.2,-5/15,-7/15,-.6,-11/15,-13/15,-1,-1,-13/15,-11/15,-.6,-7/15,-5/15,-.2,-1/15]),new Float64Array([1,-1]),new Float64Array([1,-1,-1,-1]),new Float64Array([1,-1,-1,-1,-1,-1,-1,-1]),new Float64Array([1/31,3/31,5/31,7/31,9/31,11/31,13/31,15/31,17/31,19/31,21/31,23/31,25/31,27/31,29/31,1,-1,-29/31,-27/31,-25/31,-23/31,-21/31,-19/31,-17/31,-15/31,-13/31,-11/31,-9/31,-7/31,-5/31,-3/31,-1/31]),new Float64Array([0,-.2,-.4,-.6,-.8,-1,1,-.8,-.6,-.4,-.2,1,.8,.6,.4,.2]),new Float64Array([1,1,1,1,1,-1,-1,-1,1,1,1,1,-1,-1,-1,-1]),new Float64Array([1,-1,1,-1,1,0]),new Float64Array([0,.2,.4,.5,.6,.7,.8,.85,.9,.95,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,.95,.9,.85,.8,.7,.6,.5,.4,.2,0,-.2,-.4,-.5,-.6,-.7,-.8,-.85,-.9,-.95,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-.95,-.9,-.85,-.8,-.7,-.6,-.5,-.4,-.2])],this.k=[new Float32Array(32767),new Float32Array(32767)],this.song=null,this.pianoPressed=!1,this.pianoPitch=0,this.pianoChannel=0,this.enableIntro=!0,this.enableOutro=!1,this.loopCount=-1,this.volume=1,this.O=0,this.S=0,this.j=0,this.q=0,this.P=0,this.J=0,this.N=!0,this.H=0,this.I=0,this.K=0,this.L=0,this.R=0,this.T=0,this.U=0,this.V=0,this.W=0,this.X=0,this.Y=0,this.Z=1,this.$=!1,this._=0,this.tt=0,this.it=new Float32Array(16384),this.st=0,this.ht=0,this.rt=0,this.et=0,this.at=0,this.nt=function(t){var s=t.outputBuffer,h=s.getChannelData(0);i.synthesize(h,s.length)};for(var s=0,h=this.g;s<h.length;s++){for(var r=h[s],e=0,a=0;a<r.length;a++)e+=r[a];var n=e/r.length;for(a=0;a<r.length;a++)r[a]-=n}for(var o=0;o<this.k.length;o++){r=this.k[o];if(0==o){var f=1;for(a=0;a<32767;a++){r[a]=2*(1&f)-1;var l=f>>1;1==(f+l&1)&&(l+=16384),f=l}}else if(1==o)for(a=0;a<32767;a++)r[a]=2*Math.random()-1}null!=t&&this.setSong(t)}return Object.defineProperty(t.prototype,"playing",{get:function(){return!this.N},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"playhead",{get:function(){return this.O},set:function(t){if(null!=this.song){this.O=Math.max(0,Math.min(this.song.bars,t));var i=this.O;this.S=Math.floor(i),i=this.song.beats*(i-this.S),this.j=Math.floor(i),i=this.song.parts*(i-this.j),this.q=Math.floor(i),i=4*(i-this.q),this.P=Math.floor(i);var s=this.ot();i=s*(i-this.P),this.J=Math.floor(s-i),this.S<this.song.loopStart&&(this.enableIntro=!0),this.S>this.song.loopStart+this.song.loopLength&&(this.enableOutro=!0)}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"totalSamples",{get:function(){if(null==this.song)return 0;var t=4*this.ot()*this.song.parts*this.song.beats,i=this.loopCount;i<0&&(i=1);var s=this.song.loopLength*i;return this.enableIntro&&(s+=this.song.loopStart),this.enableOutro&&(s+=this.song.bars-(this.song.loopStart+this.song.loopLength)),s*t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"totalSeconds",{get:function(){return this.totalSamples/this.samplesPerSecond},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"totalBars",{get:function(){return null==this.song?0:this.song.bars},enumerable:!0,configurable:!0}),t.prototype.setSong=function(t){"string"==typeof t?this.song=new n(t):t instanceof n&&(this.song=t)},t.prototype.play=function(){if(this.N){this.N=!1;var t=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.oAudioContext||window.msAudioContext;this.ft=this.ft||new t,this.lt=this.ft.createScriptProcessor?this.ft.createScriptProcessor(2048,0,1):this.ft.createJavaScriptNode(2048,0,1),this.lt.onaudioprocess=this.nt,this.lt.channelCountMode="explicit",this.lt.channelInterpretation="speakers",this.lt.connect(this.ft.destination),this.samplesPerSecond=this.ft.sampleRate,this.M=2*Math.PI/(this.u*this.samplesPerSecond),this.m=2*Math.cos(this.M),this.p=1/(2*this.samplesPerSecond)}},t.prototype.pause=function(){this.N||(this.N=!0,this.lt.disconnect(this.ft.destination),this.ft.close&&(this.ft.close(),this.ft=null),this.lt=null)},t.prototype.snapToStart=function(){this.S=0,this.enableIntro=!0,this.snapToBar()},t.prototype.snapToBar=function(){this.O=this.S,this.j=0,this.q=0,this.P=0,this.J=0,this._=0,this.K=0,this.T=0,this.W=0,this.Y=0,this.st=0,this.ht=0,this.rt=0,this.et=0,this.at=0;for(var t=0;t<this.it.length;t++)this.it[t]=0},t.prototype.nextBar=function(){if(this.song){var t=this.S;this.S++,this.enableOutro?this.S>=this.song.bars&&(this.S=this.enableIntro?0:this.song.loopStart):(this.S>=this.song.loopStart+this.song.loopLength||this.S>=this.song.bars)&&(this.S=this.song.loopStart),this.O+=this.S-t}},t.prototype.prevBar=function(){if(this.song){var t=this.S;this.S--,this.S<0&&(this.S=this.song.loopStart+this.song.loopLength-1),this.S>=this.song.bars&&(this.S=this.song.bars-1),this.S<this.song.loopStart&&(this.enableIntro=!0),!this.enableOutro&&this.S>=this.song.loopStart+this.song.loopLength&&(this.S=this.song.loopStart+this.song.loopLength-1),this.O+=this.S-t}},t.prototype.synthesize=function(t,i){if(null!=this.song){var s=this.song,r=0,e=1/this.samplesPerSecond,a=this.ot(),n=this.m,o=this.p,f=this.volume,l=this.it,v=.425*Math.pow(s.reverb/h.reverbRange,.667),u=!1;for((0==this.J||this.J>a)&&(this.J=a),this.q>=s.parts&&(this.j++,this.q=0,this.P=0,this.J=a),this.j>=s.beats&&(this.S++,this.j=0,this.q=0,this.P=0,this.J=a,-1==this.loopCount&&(this.S<s.loopStart&&!this.enableIntro&&(this.S=s.loopStart),this.S>=s.loopStart+s.loopLength&&!this.enableOutro&&(this.S=s.loopStart))),this.S>=s.bars&&(this.enableOutro?(this.S=0,this.enableIntro=!0,u=!0,this.pause()):this.S=s.loopStart),this.S>=s.loopStart&&(this.enableIntro=!1);i>0;){if(u){for(;i-- >0;)t[r]=0,r++;break}var c=s.getPatternInstrument(0,this.S),d=s.getPatternInstrument(1,this.S),M=s.getPatternInstrument(2,this.S),w=s.getPatternInstrument(3,this.S),b=h.channelVolumes[0]*(5==s.instrumentVolumes[0][c]?0:Math.pow(2,-h.volumeValues[s.instrumentVolumes[0][c]]))*h.waveVolumes[s.instrumentWaves[0][c]]*h.filterVolumes[s.instrumentFilters[0][c]]*h.chorusVolumes[s.instrumentChorus[0][c]]*.5,m=h.channelVolumes[1]*(5==s.instrumentVolumes[1][d]?0:Math.pow(2,-h.volumeValues[s.instrumentVolumes[1][d]]))*h.waveVolumes[s.instrumentWaves[1][d]]*h.filterVolumes[s.instrumentFilters[1][d]]*h.chorusVolumes[s.instrumentChorus[0][d]]*.5,y=h.channelVolumes[2]*(5==s.instrumentVolumes[2][M]?0:Math.pow(2,-h.volumeValues[s.instrumentVolumes[2][M]]))*h.waveVolumes[s.instrumentWaves[2][M]]*h.filterVolumes[s.instrumentFilters[2][M]]*h.chorusVolumes[s.instrumentChorus[0][M]]*.5,p=h.channelVolumes[3]*(5==s.instrumentVolumes[3][w]?0:Math.pow(2,-h.volumeValues[s.instrumentVolumes[3][w]]))*h.drumVolumes[s.instrumentWaves[3][w]],g=this.g[s.instrumentWaves[0][c]],A=this.g[s.instrumentWaves[1][d]],F=this.g[s.instrumentWaves[2][M]],k=this.k[s.instrumentWaves[3][w]],B=g.length,O=A.length,S=F.length,j=Math.pow(2,-h.filterBases[s.instrumentFilters[0][c]]),x=Math.pow(2,-h.filterBases[s.instrumentFilters[1][d]]),q=Math.pow(2,-h.filterBases[s.instrumentFilters[2][M]]),C=1,D=h.effectTremelos[s.instrumentEffects[0][c]],E=h.effectTremelos[s.instrumentEffects[1][d]],G=h.effectTremelos[s.instrumentEffects[2][M]],P=Math.pow(2,(h.chorusOffsets[s.instrumentChorus[0][c]]+h.chorusValues[s.instrumentChorus[0][c]])/12),J=Math.pow(2,(h.chorusOffsets[s.instrumentChorus[1][d]]+h.chorusValues[s.instrumentChorus[1][d]])/12),N=Math.pow(2,(h.chorusOffsets[s.instrumentChorus[2][M]]+h.chorusValues[s.instrumentChorus[2][M]])/12),z=Math.pow(2,(h.chorusOffsets[s.instrumentChorus[0][c]]-h.chorusValues[s.instrumentChorus[0][c]])/12),H=Math.pow(2,(h.chorusOffsets[s.instrumentChorus[1][d]]-h.chorusValues[s.instrumentChorus[1][d]])/12),I=Math.pow(2,(h.chorusOffsets[s.instrumentChorus[2][M]]-h.chorusValues[s.instrumentChorus[2][M]])/12),K=7==s.instrumentChorus[0][c]?-1:1,L=7==s.instrumentChorus[1][d]?-1:1,Q=7==s.instrumentChorus[2][M]?-1:1;for(0==s.instrumentChorus[0][c]&&(this.I=this.H),0==s.instrumentChorus[1][d]&&(this.R=this.L),0==s.instrumentChorus[2][M]&&(this.V=this.U);i>0;){var R=void 0;i-=R=this.J<=i?this.J:i,this.J-=R;for(var T=0,U=0,V=0,W=0,X=0,Y=0,Z=0,$=0,_=0,tt=0,it=0,st=0,ht=0,rt=0,et=0,at=0,nt=0,ot=0,ft=0,lt=0,vt=0,ut=0,ct=0,dt=0,Mt=0,wt=this.q+this.j*s.parts,bt=0;bt<4;bt++){var mt=s.getPattern(bt,this.S),yt=null==mt?0:s.instrumentEnvelopes[bt][mt.instrument],pt=null,gt=null,At=null;if(null!=mt)for($i=0;$i<mt.notes.length;$i++)if(mt.notes[$i].end<=wt)gt=mt.notes[$i];else if(mt.notes[$i].start<=wt&&mt.notes[$i].end>wt)pt=mt.notes[$i];else if(mt.notes[$i].start>wt){At=mt.notes[$i];break}null!=pt&&null!=gt&&gt.end!=pt.start&&(gt=null),null!=pt&&null!=At&&At.start!=pt.end&&(At=null);var Ft=3==bt?69:h.keyTransposes[s.key],kt=3==bt?h.drumInterval:1,Bt=void 0,Ot=void 0,St=void 0,jt=void 0,xt=void 0,qt=void 0,Ct=void 0,Dt=!1;if(this.pianoPressed&&bt==this.pianoChannel){var Et=this.vt(Ft+this.pianoPitch*kt),Gt=mt?mt.instrument:0,Pt=void 0;3==bt?s.instrumentWaves[3][Gt]>0?(C=Math.min(1,Et*e*8),Pt=24):Pt=60:Pt=48,Bt=Et*e,Ot=1,St=Math.pow(2,-this.pianoPitch*kt/Pt),jt=0,xt=1,qt=1,Ct=Math.pow(2,h.effectVibratos[s.instrumentEffects[bt][Gt]]/12)-1}else if(null==pt)Bt=0,Ot=0,St=0,jt=0,xt=1,qt=1,Ct=0,Dt=!0;else{var Jt=void 0;Jt=2==pt.pitches.length?pt.pitches[this.P>>1]:3==pt.pitches.length?pt.pitches[3==this.P?1:this.P]:4==pt.pitches.length?pt.pitches[this.P]:pt.pitches[0];var Nt=void 0;for(Nt=1;Nt<pt.pins.length-1&&!(pt.pins[Nt].time+pt.start>wt);Nt++);var zt=pt.pins[Nt-1],Ht=pt.pins[Nt],It=4*pt.start,Kt=4*pt.end,Lt=4*(pt.start+zt.time),Qt=4*(pt.start+Ht.time),Rt=4*wt+this.P,Tt=4*wt+this.P+1,Ut=(Rt-Lt)/(Qt-Lt),Vt=(Tt-Lt)/(Qt-Lt),Wt=zt.volume*(1-Ut)+Ht.volume*Ut,Xt=zt.volume*(1-Vt)+Ht.volume*Vt,Yt=zt.interval*(1-Ut)+Ht.interval*Ut,Zt=zt.interval*(1-Vt)+Ht.interval*Vt,$t=zt.time*(1-Ut)+Ht.time*Ut,_t=zt.time*(1-Vt)+Ht.time*Vt,ti=!1;Rt==It&&(0==yt?ti=!0:2==yt?Wt=0:3==yt&&(null==gt||gt.pitches.length>1||pt.pitches.length>1?Wt=0:0==gt.pins[gt.pins.length-1].volume||0==pt.pins[0].volume?Wt=0:(Yt=.5*(gt.pitches[0]+gt.pins[gt.pins.length-1].interval-Jt),$t=.5*gt.pins[gt.pins.length-1].time,ti=!0))),Tt==Kt&&(1==yt||2==yt?Xt=0:3==yt&&(null==At||At.pitches.length>1||pt.pitches.length>1?Xt=0:0==pt.pins[pt.pins.length-1].volume||0==At.pins[0].volume?Wt=0:(Zt=.5*(At.pitches[0]+pt.pins[pt.pins.length-1].interval-Jt),_t*=.5)));var ii=1-(this.J+R)/a,si=1-this.J/a,hi=Yt*(1-ii)+Zt*ii,ri=Yt*(1-si)+Zt*si,ei=$t*(1-ii)+_t*ii,ai=$t*(1-si)+_t*si,ni=this.vt(Ft+(Jt+hi)*kt),oi=this.vt(Ft+(Jt+ri)*kt),fi=void 0;3==bt?s.instrumentWaves[3][mt.instrument]>0?(C=Math.min(1,ni*e*8),fi=24):fi=60:fi=48;var li=Math.pow(2,-(Jt+hi)*kt/fi),vi=Math.pow(2,-(Jt+ri)*kt/fi);li*=this.ut(Wt*(1-ii)+Xt*ii),vi*=this.ut(Wt*(1-si)+Xt*si);var ui=oi/ni;Bt=ni*e,Ot=Math.pow(ui,1/R),St=li,jt=(vi-li)/R,0!=(Rt+ii-It)*a/this.samplesPerSecond||ti||(Dt=!0);var ci=h.filterDecays[s.instrumentFilters[bt][mt.instrument]];xt=Math.pow(2,-ci*ei*4*a/this.samplesPerSecond);var di=Math.pow(2,-ci*ai*4*a/this.samplesPerSecond);qt=Math.pow(di/xt,1/R),Ct=2==s.instrumentEffects[bt][mt.instrument]&&wt-pt.start<3?0:Math.pow(2,h.effectVibratos[s.instrumentEffects[bt][mt.instrument]]/12)-1}0==bt?(T=Bt,U=Ot,V=St*b,W=jt*b,X=xt*j,Y=qt,Z=Ct,Dt&&(this.K=0,this.H=0,this.I=0)):1==bt?($=Bt,_=Ot,tt=St*m,it=jt*m,st=xt*x,ht=qt,rt=Ct,Dt&&(this.T=0,this.L=0,this.R=0)):2==bt?(et=Bt,at=Ot,nt=St*y,ot=jt*y,ft=xt*q,lt=qt,vt=Ct,Dt&&(this.W=0,this.U=0,this.V=0)):3==bt&&(ut=Bt/32767,ct=Ot,dt=St*p,Mt=jt*p)}for(var Mi=Math.sin(this._),wi=Math.sin(this._-this.M),bi=+this.K,mi=+this.H,yi=+this.I,pi=+this.T,gi=+this.L,Ai=+this.R,Fi=+this.W,ki=+this.U,Bi=+this.V,Oi=+this.Y,Si=+this.X,ji=0|this.st,xi=+this.ht,qi=+this.rt,Ci=+this.et,Di=+this.at,Ei=+this.tt;R;){var Gi=1+Z*Mi,Pi=1+rt*Mi,Ji=1+vt*Mi,Ni=1+D*(Mi-1),zi=1+E*(Mi-1),Hi=1+G*(Mi-1),Ii=Mi;Mi=n*Mi-wi,wi=Ii,bi+=((g[0|mi*B]+g[0|yi*B]*K)*V*Ni-bi)*X,pi+=((A[0|gi*O]+A[0|Ai*O]*L)*tt*zi-pi)*st,Fi+=((F[0|ki*S]+F[0|Bi*S]*Q)*nt*Hi-Fi)*ft,Oi+=(k[0|32767*Si]*dt-Oi)*C,V+=W,tt+=it,nt+=ot,dt+=Mt,mi+=T*Gi*P,yi+=T*Gi*z,gi+=$*Pi*J,Ai+=$*Pi*H,ki+=et*Ji*N,Bi+=et*Ji*I,Si+=ut,T*=U,$*=_,et*=at,ut*=ct,X*=Y,st*=ht,ft*=lt,mi-=0|mi,yi-=0|yi,gi-=0|gi,Ai-=0|Ai,ki-=0|ki,Bi-=0|Bi,Si-=0|Si;var Ki=bi+pi+Fi,Li=l[ji]+Ki,Qi=l[ji+3041&16383],Ri=l[ji+6426&16383],Ti=l[ji+10907&16383],Ui=-Li+Qi,Vi=-Li-Qi,Wi=-Ri+Ti,Xi=-Ri-Ti;xi+=.5*((Ui+Wi)*v-xi),qi+=.5*((Vi+Xi)*v-qi),Ci+=.5*((Ui-Wi)*v-Ci),Di+=.5*((Vi-Xi)*v-Di),l[ji+3041&16383]=xi,l[ji+6426&16383]=qi,l[ji+10907&16383]=Ci,l[ji]=Di,ji=ji+1&16383;var Yi=Li+Qi+Ri+Ti+Oi,Zi=Yi<0?-Yi:Yi;(Ei-=o)<Zi&&(Ei=Zi),Yi/=.75*Ei+.25,Yi*=f,t[r]=Yi,r+=1,R--}if(this.K=bi,this.H=mi,this.I=yi,this.T=pi,this.L=gi,this.R=Ai,this.W=Fi,this.U=ki,this.V=Bi,this.Y=Oi,this.X=Si,this.st=ji,this.ht=xi,this.rt=qi,this.et=Ci,this.at=Di,this.tt=Ei,this._=n*Mi-wi>wi?Math.asin(Mi):Math.PI-Math.asin(Mi),0==this.J&&(this.P++,this.J=a,4==this.P&&(this.P=0,this.q++,this.q==s.parts&&(this.q=0,this.j++,this.j==s.beats)))){this.j=0,this._=0,this.S++,this.S<s.loopStart?this.enableIntro||(this.S=s.loopStart):this.enableIntro=!1,this.S>=s.loopStart+s.loopLength&&(this.loopCount>0&&this.loopCount--,(this.loopCount>0||!this.enableOutro)&&(this.S=s.loopStart)),this.S>=s.bars&&(this.S=0,this.enableIntro=!0,u=!0,this.pause());break}}}this.O=(((this.P+1-this.J/a)/4+this.q)/s.parts+this.j)/s.beats+this.S}else for(var $i=0;$i<i;$i++)t[$i]=0},t.prototype.vt=function(t){return 440*Math.pow(2,(t-69)/12)},t.prototype.ut=function(t){return Math.pow(t/3,1.5)},t.prototype.ot=function(){if(null==this.song)return 0;var t=4*(this.song.getBeatsPerMinute()/60*this.song.parts);return Math.floor(this.samplesPerSecond/t)},t}();t.Synth=o}(beepbox||(beepbox={}));